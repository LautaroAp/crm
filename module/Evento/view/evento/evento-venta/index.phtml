<script src="js/functions.js"></script>
<?php
$meses = [
    'N/A', 'Enero', 'Febrero', 'Marzo', 'Abril', 'Mayo', 'Junio', 'Julio',
    'Agosto', 'Septiembre', 'Octubre', 'Noviembre', 'Diciembre'
];


?>

<div class="container margen">
    <div class="row">
        <div class="col-md-12">
            <div class="panel panel-default sombra-ficha">
                <div class="panel-heading text-center titulo-espaciado">
                    RESUMEN DE EVENTOS
                </div>
                <div class="panel-body">
                    <form method="post">
                        <div class="row form-row">                            
                            <div class="form-group col-md-3" <?php if (($persona=="cliente") or ($persona=="proveedor")) {echo("hidden");} ?>>
                                <!-- <label>Tipo de persona</label> -->
                                <select class="form-control" id="tipo_persona" name="tipo_persona" onchange="actualizarDatosTipoEvento(this.value)" >
                                <option value="<?php if (!is_null($tipoPersona)) {
                                                    echo ($tipoPersona);
                                                } else {
                                                    echo ("-1");
                                                } ?>" hidden=""> 
                                    <?php if (!is_null($tipoPersona)) {
                                        echo (ucwords(strtolower($tipoPersona)));
                                    } else {
                                        echo ("Todos");
                                    } ?> 
                                </option>
                                <option value=-1>Todos</option>
                                <option value="CLIENTE">Cliente</option>
                                <option value="PROVEEDOR">Proveedor</option>
                                </select>
                            </div>
                            <div class="form-group col-md-3" >
                                <div id="div_tipo_eve">
                                <select class="form-control" id="ops_tipos" name="tipo" required="">
                                    <!-- <option value=-1> Seleccionar Acción Comercial </option>  -->
                                    <option value="<?php if ((!is_null($tipoPersona)) and (!is_null($accionComercial))) {
                                                    echo ($accionComercial->getId());
                                                } else {
                                                    echo ("-1");
                                                } ?>" hidden=""> 
                                    <?php if ((!is_null($tipoPersona)) and (!is_null($accionComercial))) {
                                        echo (ucwords(strtolower($accionComercial->getNombre())));
                                    } else {
                                        echo ("Seleccionar Accion Comercial");
                                    } ?> 
                                </option>
                                    <?php if ($tipoPersona){
                                        foreach ($tipos as $tipo){ ?>
                                            <option value="<?php echo $tipo->getId(); ?>"> <?php echo $tipo->getNombre();?> </option> 
                                        <?php }
                                    }?>
                                </select>
                                </div>
                            </div>
                            <div class="form-group col-sm-2">
                                <input type="number" class="form-control" name="ventas_m" min="1" max="12" placeholder="Mes" 
                                value="<?php if (isset($parametros['ventas_m'])) {
                                        echo ($parametros['ventas_m']);
                                    } ?>">                        
                            </div>
                            <div class="form-group col-sm-2">
                                <input type="number" class="form-control" name="ventas_y" min="2000" max="<?php echo date("Y"); ?>" 
                                placeholder="Año" value="<?php if (isset($parametros['ventas_m'])) {
                                                                    echo ($parametros['ventas_y']);
                                                                } ?>">                        
                            </div>
                            <div class="form-group col-sm-1">
                                <button type="submit" class="btn btn-default"> 
                                    <i class="glyphicon glyphicon-search"></i> Buscar
                                </button>  
                            </div>
                        </div>
                    </form>
                    <div class="container row">
                            Total
                            <?php
                            if (isset($parametros['tipo'])) {
                                echo ($parametros['tipo']);
                            }
                            if (isset($parametros['ventas_m'])) {
                                if (($parametros['ventas_m']) != 0) {
                                    echo (' ' . $meses[$parametros['ventas_m']]);
                                }
                            }
                            if (isset($parametros['ventas_y'])) {
                                echo (' ' . $parametros['ventas_y'] . ' ');
                            }
                            echo (': ' . count($total));
                            ?>
                    </div>
                    <p>
                    </p>
                    <table id="tabla_evento" class="table table-bordred table-striped">
                        <thead>
                            <tr>
                                <th>Fecha</th>
                                <th>Responsable</th>
                                <th>Evento</th>
                                <th>Nombre</th>
                                <th>Categoría</th>
                            </tr>
                        </thead>
                        <?php foreach ($eventos as $evento) : ?>
                        <tr>
                            <td><?php if (!is_null($evento->getFecha())) {
                                    echo ($evento->getFecha()->format('d/m/Y'));
                                } ?></td>
                            <td><?php echo ($evento->getUsuarioEjecutivo()); ?></td>
                            <td><?php echo ($evento->getTipo()); ?></td>
                            <td><?php echo ($evento->getNombrePersona()); ?></td>
                            <td><?php echo ($evento->getPersona()->getTipo()); ?></td>

                            <td class="table-items-right">
                                <a class="btn btn-default" 
                                <?php if (strtoupper($evento->getPersona()->getTipo()) == "CLIENTE") { ?>
                                    href=<?= $this->url('clientes/ficha', ['action' => 'ficha', 'id' => $evento->getPersona()->getId()]); ?> 
                                <?php 
                            } elseif (strtoupper($evento->getPersona()->getTipo()) == "PROVEEDOR") { ?>
                                    href=<?= $this->url('proveedores/ficha', ['action' => 'ficha', 'id' => $evento->getPersona()->getId()]); ?>
                                <?php 
                            } ?>>
                                <span class="glyphicon glyphicon-share-alt" ></span>
                                </a>
                            </td>
                        </tr>
                    <?php endforeach; ?>
                    </table>
                </div>
            </div>
        </div>
    </div>  
    <?php
    echo $this->paginationControl(
        $eventos,
        'Sliding', // All, Elastic, Jumping, Sliding
        'search_pagination3.phtml',
        $this->url('pageventas', ['action' => 'index', 'id' => 1])
    );
    ?>     
</div>

<!-- Inicio: Panel Botones -->
<div class="container margen">
    <div class="row img-centrar">
        <div class="col ficha-cliente-p img-centrar">
            <div>
                <a href="<?= $volver ?>">
                <img src="<?= $this->basePath('img/crm/volver_b.png') ?>"
                    class="img-rounded img-responsive img-texto-derecha zoom">
                </a>
            </div>
            <div class="ficha-cliente-label">
                <label>Volver</label>
            </div>
        </div>
    </div>
</div>
<!-- Fin: Panel Botones -->